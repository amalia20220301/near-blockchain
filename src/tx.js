import {sha256} from "js-sha256";
import nacl from "tweetnacl";
import {getPrivKey} from "./address.js";
import _ from 'lodash';
export const signTx = (hdpath, message)=>{
    const privKey = getPrivKey(hdpath)
    const hash = new Uint8Array(sha256.array(message))
    console.log('---------------')
    console.log(Buffer.from(hash).toString('hex'))
    console.log('---------------')
    return nacl.sign.detached(hash, privKey);
}

console.log('-----signTx----------')
const message = {
    "0": 16,
    "1": 0,
    "2": 0,
    "3": 0,
    "4": 100,
    "5": 101,
    "6": 109,
    "7": 111,
    "8": 48,
    "9": 54,
    "10": 49,
    "11": 55,
    "12": 46,
    "13": 116,
    "14": 101,
    "15": 115,
    "16": 116,
    "17": 110,
    "18": 101,
    "19": 116,
    "20": 0,
    "21": 77,
    "22": 88,
    "23": 159,
    "24": 92,
    "25": 166,
    "26": 117,
    "27": 52,
    "28": 142,
    "29": 159,
    "30": 216,
    "31": 139,
    "32": 132,
    "33": 146,
    "34": 164,
    "35": 251,
    "36": 204,
    "37": 230,
    "38": 34,
    "39": 175,
    "40": 196,
    "41": 26,
    "42": 213,
    "43": 76,
    "44": 173,
    "45": 120,
    "46": 124,
    "47": 43,
    "48": 185,
    "49": 123,
    "50": 172,
    "51": 185,
    "52": 57,
    "53": 11,
    "54": 156,
    "55": 18,
    "56": 216,
    "57": 56,
    "58": 84,
    "59": 0,
    "60": 0,
    "61": 16,
    "62": 0,
    "63": 0,
    "64": 0,
    "65": 100,
    "66": 101,
    "67": 109,
    "68": 111,
    "69": 48,
    "70": 54,
    "71": 49,
    "72": 55,
    "73": 46,
    "74": 116,
    "75": 101,
    "76": 115,
    "77": 116,
    "78": 110,
    "79": 101,
    "80": 116,
    "81": 210,
    "82": 89,
    "83": 122,
    "84": 233,
    "85": 25,
    "86": 39,
    "87": 37,
    "88": 236,
    "89": 145,
    "90": 253,
    "91": 44,
    "92": 142,
    "93": 152,
    "94": 192,
    "95": 99,
    "96": 70,
    "97": 248,
    "98": 248,
    "99": 24,
    "100": 159,
    "101": 42,
    "102": 117,
    "103": 70,
    "104": 63,
    "105": 25,
    "106": 239,
    "107": 164,
    "108": 132,
    "109": 137,
    "110": 218,
    "111": 118,
    "112": 34,
    "113": 1,
    "114": 0,
    "115": 0,
    "116": 0,
    "117": 6,
    "118": 0,
    "119": 35,
    "120": 246,
    "121": 249,
    "122": 27,
    "123": 223,
    "124": 10,
    "125": 166,
    "126": 233,
    "127": 65,
    "128": 192,
    "129": 246,
    "130": 195,
    "131": 48,
    "132": 175,
    "133": 13,
    "134": 17,
    "135": 180,
    "136": 206,
    "137": 49,
    "138": 185,
    "139": 205,
    "140": 205,
    "141": 55,
    "142": 120,
    "143": 92,
    "144": 130,
    "145": 87,
    "146": 123,
    "147": 77,
    "148": 178,
    "149": 105,
    "150": 232
}
const data = Buffer.from(_.values(message))
console.log(Buffer.from(signTx("m/44'/397'/0'/0'/1'", data)).toString('hex'))
console.log('---------------')
